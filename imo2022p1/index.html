
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMO 2022 P1 - The Bank of Oslo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .problem-section {
            background: #f8f9fa;
            padding: 30px;
            border-bottom: 3px solid #667eea;
        }

        .tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 3px solid #667eea;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05em;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
            white-space: nowrap;
        }

        .tab:hover {
            background: #dee2e6;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        .insight-box {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%);
            border-left: 5px solid #667eea;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .insight-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .example-section {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }

        .coins-display {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            align-items: center;
        }

        .coin {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.1em;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            position: relative;
        }

        .coin:hover {
            transform: scale(1.15);
        }

        .coin.A {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .coin.B {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .coin.k-position {
            box-shadow: 0 0 0 4px #ffc107, 0 3px 12px rgba(0,0,0,0.3);
            animation: glow 1.5s infinite;
            transform: scale(1.1);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 0 4px #ffc107, 0 3px 12px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 0 0 6px #ffc107, 0 3px 16px rgba(255, 193, 7, 0.5); }
        }

        .coin.in-chain-to-move {
            border: 3px solid #28a745;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
        }

        .coin.leftmost-n {
            border: 2px solid #28a745;
        }

        .block-divider {
            width: 3px;
            height: 45px;
            background: linear-gradient(180deg, #dc3545 0%, #c82333 100%);
            margin: 0 8px;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .step-container {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .step-header {
            font-weight: 700;
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .block-count-badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .arrow {
            font-size: 2em;
            color: #667eea;
            text-align: center;
            margin: 10px 0;
        }

        .explanation {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 3px solid #28a745;
        }

        .counterexample-box {
            background: #fff5f5;
            border-left: 5px solid #dc3545;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .counterexample-box h4 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .success-box h4 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #555;
        }

        .control-group input,
        .control-group select {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1em;
            min-width: 150px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .formula-box {
            background: #e7f3ff;
            border: 3px solid #667eea;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .formula {
            font-size: 1.6em;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IMO 2022 Problem 1: The Bank of Oslo</h1>
            <p style="font-size: 1.2em;">Interactive Visualization & Solution</p>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="showTab('walkthrough')">üìñ Walkthrough</div>
            <div class="tab" onclick="showTab('examples')">üéØ Examples</div>
            <div class="tab" onclick="showTab('simulator')">üéÆ Simulator</div>
            <div class="tab" onclick="showTab('proof')">üìê Complete Proof</div>
        </div>

        <div id="walkthrough-tab" class="tab-content active">
            <h2 style="color: #667eea; margin-bottom: 25px;">Understanding The Problem</h2>

            <div class="insight-box">
                <h3>üéØ The Key Insight</h3>
                <p style="font-size: 1.1em; line-height: 1.8;">
                    <strong>When you move an INNER block</strong> (not the leftmost or rightmost), the blocks on its left and right <strong>combine into one</strong>. This is the fundamental mechanism that reduces the number of blocks!
                </p>
            </div>

            <div class="example-section">
                <h3 style="color: #667eea; margin-bottom: 20px;">Visual Example: n = 4, k = 5</h3>
                <p style="margin-bottom: 20px;">Let's watch what happens starting from AABBBABA with k = 5 (the 5th coin):</p>

                <div id="walkthrough-demo"></div>
            </div>

            <div class="insight-box">
                <h3>üí° Why This Works</h3>
                <p style="font-size: 1.05em; line-height: 1.8;">
                    <strong>Goal:</strong> Get to exactly 2 blocks (all A's then all B's, or vice versa)<br><br>
                    <strong>Strategy:</strong> Keep moving blocks until we combine enough to reach 2 blocks<br><br>
                    <strong>Key Observation:</strong> For the valid range of k (n ‚â§ k ‚â§ ‚åà3n/2‚åâ), we can't keep moving only the rightmost block forever. Eventually, an inner block gets moved, neighbors combine, and the block count decreases!
                </p>
            </div>

            <div class="counterexample-box">
                <h4>‚ùå Why k < n Fails</h4>
                <p style="margin-bottom: 15px;"><strong>Example with n = 4, k = 3:</strong></p>
                <p>Configuration: A¬≥B‚Å¥A (which is AAA BBBB A)</p>
                <p style="margin-top: 10px;">The k-th coin (3rd coin) is in the <strong>leftmost block</strong> of A's. Moving it does nothing - it's already at the left! This is a <strong>stuck configuration</strong> with 3 blocks that never reaches 2 blocks.</p>
            </div>

            <div class="counterexample-box">
                <h4>‚ùå Why k > ‚åà3n/2‚åâ Fails</h4>
                <p style="margin-bottom: 15px;"><strong>Example with n = 4, k = 7:</strong></p>
                <p>Configuration: A¬≤B¬≤A¬≤B¬≤ (which is AA BB AA BB)</p>
                <p style="margin-top: 10px;">The k-th coin is in the <strong>rightmost block</strong>. After moving it left, the <em>new</em> rightmost block also contains the k-th coin. This cycles forever through 4 blocks without ever combining!</p>
            </div>
        </div>

        <div id="examples-tab" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">Interactive Examples</h2>

            <div class="controls">
                <div class="control-group">
                    <label>Choose Example:</label>
                    <select id="example-select" onchange="loadExample()">
                        <option value="problem">Problem Example: n=4, k=4</option>
                        <option value="walkthrough">Walkthrough: n=4, k=5</option>
                        <option value="fail-small">Fails (k too small): n=4, k=3</option>
                        <option value="fail-large">Fails (k too large): n=4, k=7</option>
                    </select>
                </div>
                <button onclick="stepForward()">Next Step ‚ñ∂</button>
                <button onclick="stepBackward()" class="secondary">‚óÄ Previous Step</button>
                <button onclick="resetExample()" class="secondary">Reset</button>
            </div>

            <div id="example-display"></div>
        </div>

        <div id="simulator-tab" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">Custom Simulator</h2>

            <div class="controls">
                <div class="control-group">
                    <label for="sim-n">Value of n:</label>
                    <input type="number" id="sim-n" min="1" max="10" value="4">
                </div>
                <div class="control-group">
                    <label for="sim-k">Value of k:</label>
                    <input type="number" id="sim-k" min="1" max="20" value="5">
                </div>
                <div class="control-group">
                    <label for="sim-config">Initial Configuration:</label>
                    <input type="text" id="sim-config" placeholder="e.g., AABBBABA" style="min-width: 200px;">
                </div>
                <button onclick="runSimulation()">Run Simulation</button>
                <button onclick="generateRandom()" class="secondary">Random Config</button>
            </div>

            <div id="simulator-output"></div>
        </div>

        <div id="proof-tab" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">Complete Mathematical Proof</h2>

            <div class="formula-box">
                <h3 style="color: #667eea;">Answer</h3>
                <div class="formula">n ‚â§ k ‚â§ ‚åà3n/2‚åâ</div>
                <p style="color: #666; margin-top: 10px;">Equivalently: n ‚â§ k ‚â§ ‚åä(3n+1)/2‚åã</p>
            </div>

            <div class="success-box">
                <h4>Part 1: Necessity (Why other values fail)</h4>
                <p><strong>Case 1: If k < n</strong></p>
                <p style="margin: 10px 0 10px 20px;">
                    Counterexample: A<sup>n-1</sup>B<sup>n</sup>A<br>
                    The k-th coin (k ‚â§ n-1) is in the first block of A's. Since it's already leftmost, moving it changes nothing. This configuration has 3 blocks and stays stuck forever.
                </p>

                <p style="margin-top: 20px;"><strong>Case 2: If k > ‚åà3n/2‚åâ</strong></p>
                <p style="margin: 10px 0 10px 20px;">
                    Counterexample: A<sup>a</sup>B<sup>b</sup>A<sup>b</sup>B<sup>a</sup> where a = k - n - 1, b = 2n - k + 1<br>
                    The k-th coin stays in the rightmost block at every step, creating a cycle that never reduces to 2 blocks.
                </p>
            </div>

            <div class="success-box">
                <h4>Part 2: Sufficiency (Why n ‚â§ k ‚â§ ‚åà3n/2‚åâ always works)</h4>
                <p><strong>Proof by Induction on Number of Blocks</strong></p>

                <p style="margin: 15px 0 10px 20px;">
                    <strong>Base case:</strong> If we have 2 blocks, we're done! ‚úì
                </p>

                <p style="margin: 15px 0 10px 20px;">
                    <strong>If we have 3 blocks:</strong> The first block has length ‚â§ n-1 (otherwise we'd already be sorted). Since k ‚â• n, the k-th coin is in the 2nd or 3rd block. Moving either combines blocks ‚Üí we reach 2 blocks. ‚úì
                </p>

                <p style="margin: 15px 0 10px 20px;">
                    <strong>If we have ‚â• 4 blocks:</strong> Three observations:<br>
                    1. <em>Moving an inner block</em> ‚Üí neighbors combine ‚Üí block count decreases (induction applies) ‚úì<br>
                    2. <em>Leftmost block never picked:</em> It has length ‚â§ n-1, but k ‚â• n ‚úì<br>
                    3. <em>Can't always pick rightmost block:</em> If we did, every block would need length > n/2 (since k ‚â§ ‚åà3n/2‚åâ means the rightmost block must reach position k). But 4 blocks each with length > n/2 gives total length > 2n, contradiction! ‚úì
                </p>

                <p style="margin: 15px 0 10px 20px;">
                    Therefore, eventually an inner block is picked, the block count decreases, and by induction we reach 2 blocks!
                </p>
            </div>
        </div>
    </div>

    <script>
        let currentExample = null;
        let currentStep = 0;

        const examples = {
            problem: {
                n: 4,
                k: 4,
                initial: 'AABBBABA',
                description: 'Example from the problem statement'
            },
            walkthrough: {
                n: 4,
                k: 5,
                initial: 'AABBBABA',
                description: 'Walkthrough example showing block combination'
            },
            'fail-small': {
                n: 4,
                k: 3,
                initial: 'AAABBBBBA',
                description: 'k < n: Stuck at leftmost block'
            },
            'fail-large': {
                n: 4,
                k: 7,
                initial: 'AABBAABB',
                description: 'k > ‚åà3n/2‚åâ: Cycles through rightmost blocks'
            }
        };

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function findChainContaining(coins, k) {
            const type = coins[k - 1];
            let start = k - 1;
            let end = k - 1;
            while (start > 0 && coins[start - 1] === type) start--;
            while (end < coins.length - 1 && coins[end + 1] === type) end++;
            return { start, end, type };
        }

        function performOperation(coins, k) {
            const chain = findChainContaining(coins, k);
            const chainCoins = coins.slice(chain.start, chain.end + 1);
            const remaining = coins.slice(0, chain.start).concat(coins.slice(chain.end + 1));
            return chainCoins.concat(remaining);
        }

        function countBlocks(coins) {
            if (coins.length === 0) return 0;
            let count = 1;
            for (let i = 1; i < coins.length; i++) {
                if (coins[i] !== coins[i-1]) count++;
            }
            return count;
        }

        function renderCoins(coins, k, n, highlightChain = false) {
            const chain = k ? findChainContaining(coins, k) : null;
            let html = '<div class="coins-display">';

            coins.forEach((coin, i) => {
                if (i > 0 && coins[i] !== coins[i-1]) {
                    html += '<div class="block-divider"></div>';
                }

                let classes = `coin ${coin}`;
                if (k && i === k - 1) classes += ' k-position';
                if (highlightChain && chain && i >= chain.start && i <= chain.end) {
                    classes += ' in-chain-to-move';
                }
                if (n && i < n) classes += ' leftmost-n';

                html += `<div class="${classes}" title="Position ${i+1}: ${coin}">${coin}</div>`;
            });

            html += '</div>';
            return html;
        }

        function simulateSteps(config, k, maxSteps = 20) {
            let coins = config.split('');
            const steps = [{
                coins: coins.slice(),
                blocks: countBlocks(coins),
                chain: findChainContaining(coins, k),
                sorted: countBlocks(coins) === 2
            }];

            const seen = new Set([coins.join('')]);

            for (let i = 0; i < maxSteps; i++) {
                const chain = findChainContaining(coins, k);
                coins = performOperation(coins, k);
                const configStr = coins.join('');

                steps.push({
                    coins: coins.slice(),
                    blocks: countBlocks(coins),
                    chain: findChainContaining(coins, k),
                    sorted: countBlocks(coins) === 2,
                    cycle: seen.has(configStr)
                });

                if (seen.has(configStr) || countBlocks(coins) === 2) break;
                seen.add(configStr);
            }

            return steps;
        }

        // Initialize walkthrough
        function initWalkthrough() {
            const steps = simulateSteps('AABBBABA', 5);
            let html = '';

            steps.forEach((step, i) => {
                const isSorted = step.sorted;
                const prevStep = i > 0 ? steps[i-1] : null;

                html += `<div class="step-container">`;
                html += `<div class="step-header">
                    Step ${i}
                    <span class="block-count-badge">${step.blocks} blocks</span>
                    ${isSorted ? '<span style="color: #28a745; margin-left: 10px;">‚úì SORTED!</span>' : ''}
                </div>`;

                html += renderCoins(step.coins, 5, 4, i < steps.length - 1);

                if (i < steps.length - 1 && !isSorted) {
                    const chain = step.chain;
                    const chainStr = step.coins.slice(chain.start, chain.end + 1).join('');
                    const isInner = chain.start > 0 && chain.end < step.coins.length - 1;

                    html += `<div class="explanation">`;
                    if (isInner) {
                        html += `<strong>Moving inner block ${chainStr}</strong> ‚Üí The blocks on its left and right will <strong>combine</strong>!`;
                    } else if (chain.end === step.coins.length - 1) {
                        html += `<strong>Moving rightmost block ${chainStr}</strong> ‚Üí No combination happens`;
                    } else {
                        html += `<strong>Moving block ${chainStr}</strong>`;
                    }
                    html += `</div>`;

                    html += `<div class="arrow">‚Üì</div>`;
                }

                html += `</div>`;
            });

            document.getElementById('walkthrough-demo').innerHTML = html;
        }

        function loadExample() {
            const exampleKey = document.getElementById('example-select').value;
            currentExample = examples[exampleKey];
            currentStep = 0;
            displayExample();
        }

        function displayExample() {
            if (!currentExample) {
                loadExample();
                return;
            }

            const steps = simulateSteps(currentExample.initial, currentExample.k);
            const step = steps[currentStep];

            let html = `<h3 style="color: #667eea; margin-bottom: 20px;">${currentExample.description}</h3>`;
            html += `<p style="margin-bottom: 20px;"><strong>n = ${currentExample.n}, k = ${currentExample.k}</strong></p>`;

            html += `<div class="step-container">`;
            html += `<div class="step-header">
                Step ${currentStep} of ${steps.length - 1}
                <span class="block-count-badge">${step.blocks} blocks</span>
                ${step.sorted ? '<span style="color: #28a745;">‚úì SORTED!</span>' : ''}
                ${step.cycle ? '<span style="color: #dc3545;">‚ö† CYCLE DETECTED</span>' : ''}
            </div>`;

            html += renderCoins(step.coins, currentExample.k, currentExample.n, currentStep < steps.length - 1);

            if (currentStep < steps.length - 1 && !step.sorted && !step.cycle) {
                const chain = step.chain;
                const chainStr = step.coins.slice(chain.start, chain.end + 1).join('');
                const isInner = chain.start > 0 && chain.end < step.coins.length - 1;
                const isLeft = chain.start === 0;
                const isRight = chain.end === step.coins.length - 1;

                html += `<div class="explanation">`;
                html += `<strong>Chain to move: ${chainStr}</strong><br>`;
                if (isInner) {
                    html += `This is an <strong>inner block</strong> ‚Üí neighbors will combine when moved!`;
                } else if (isRight) {
                    html += `This is the <strong>rightmost block</strong> ‚Üí no combination`;
                } else if (isLeft) {
                    html += `This is already the <strong>leftmost block</strong> ‚Üí stuck!`;
                }
                html += `</div>`;
            }

            html += `</div>`;

            document.getElementById('example-display').innerHTML = html;
        }

        function stepForward() {
            if (!currentExample) return;
            const steps = simulateSteps(currentExample.initial, currentExample.k);
            if (currentStep < steps.length - 1) {
                currentStep++;
                displayExample();
            }
        }

        function stepBackward() {
            if (currentStep > 0) {
                currentStep--;
                displayExample();
            }
        }

        function resetExample() {
            currentStep = 0;
            displayExample();
        }

        function generateRandom() {
            const n = parseInt(document.getElementById('sim-n').value);
            const coins = Array(n).fill('A').concat(Array(n).fill('B'));
            for (let i = coins.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [coins[i], coins[j]] = [coins[j], coins[i]];
            }
            document.getElementById('sim-config').value = coins.join('');
        }

        function runSimulation() {
            const n = parseInt(document.getElementById('sim-n').value);
            const k = parseInt(document.getElementById('sim-k').value);
            const config = document.getElementById('sim-config').value.toUpperCase();

            if (!config || config.length !== 2*n) {
                alert(`Configuration must have exactly ${2*n} coins`);
                return;
            }

            const aCount = (config.match(/A/g) || []).length;
            const bCount = (config.match(/B/g) || []).length;
            if (aCount !== n || bCount !== n) {
                alert(`Must have exactly ${n} A's and ${n} B's`);
                return;
            }

            const steps = simulateSteps(config, k);
            const upperBound = Math.ceil((3 * n) / 2);
            const inRange = k >= n && k <= upperBound;

            let html = `<div class="formula-box">
                <h3>Configuration: n=${n}, k=${k}</h3>
                <p>Valid range for k: ${n} ‚â§ k ‚â§ ${upperBound}</p>
                <p style="margin-top: 10px;"><strong>k=${k} is ${inRange ? 'IN' : 'OUTSIDE'} the valid range</strong></p>
            </div>`;

            steps.forEach((step, i) => {
                html += `<div class="step-container">`;
                html += `<div class="step-header">
                    Step ${i}
                    <span class="block-count-badge">${step.blocks} blocks</span>
                    ${step.sorted ? '<span style="color: #28a745;">‚úì SORTED!</span>' : ''}
                    ${step.cycle ? '<span style="color: #dc3545;">‚ö† CYCLE</span>' : ''}
                </div>`;
                html += renderCoins(step.coins, k, n, i < steps.length - 1 && !step.sorted);
                if (i < steps.length - 1) html += `<div class="arrow">‚Üì</div>`;
                html += `</div>`;
            });

            document.getElementById('simulator-output').innerHTML = html;
        }

        // Initialize
        initWalkthrough();
        loadExample();
        document.getElementById('sim-config').value = 'AABBBABA';
    </script>
</body>
</html>
