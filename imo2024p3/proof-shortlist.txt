Let $a_{1}, a_{2}, a_{3}, \ldots$ be an infinite sequence of positive integers, and let $N$ be a positive integer. Suppose that, for each $n>N$, the number $a_{n}$ is equal to the number of times $a_{n-1}$ appears in the list $\left(a_{1}, a_{2}, \ldots, a_{n-1}\right)$. Prove that at least one of the sequences $a_{1}, a_{3}, a_{5}, \ldots$ and $a_{2}, a_{4}, a_{6}, \ldots$ is eventually periodic.

Set $M:=\max \left(a_{1}, \ldots, a_{N}\right)$.

Setup. We will visualize the entire process as follows. We draw a stack of towers labeled $1,2, \ldots$, each initially empty. For $i=1,2, \ldots$, we imagine the term $a_{i}$ as adding a block $B_{i}$ to tower $a_{i}$.

Then there are $N$ initial blocks placed, colored red. The rest of the blocks are colored yellow: if the last block $B_{i}$ was added to a tower that then reaches height $a_{i+1}$, the next block $B_{i+1}$ is added to tower $a_{i+1}$. We'll say $B_{i}$ contributes to the tower containing $B_{i+1}$.

In other words, the yellow blocks $B_{i}$ for $i>N$ are given coordinates $B_{i}=\left(a_{i}, a_{i+1}\right)$ for $i>N$. Note in particular that in towers $M+1, M+2, \ldots$, the blocks are all yellow.\\

We let $h_{\ell}$ denote the height of the $\ell^{\text {th }}$ tower at a given time $n$. (This is an abuse of notation and we should write $h_{\ell}(n)$ at time $n$, but $n$ will always be clear from context.)

I Up to alternating up and down. We start with two independent easy observations: the set of numbers that occur infinitely often is downwards closed, and consecutive terms cannot both be huge.

Proof. Suppose $B_{n}$ is a yellow block in tower $k+1$. Then with at most finitely many exceptions, $B_{n-1}$ is a yellow block at height $k+1$, and the block $B_{r}$ right below $B_{n-1}$ is also yellow; then $B_{r+1}$ is in tower $k$. Hence, with at most finitely many exceptions, the map

$$
B_{n} \mapsto B_{n-1} \mapsto B_{r} \mapsto B_{r+1}
$$

provides an injective map taking each yellow block in tower $k+1$ to a yellow block in tower $k$. (The figure above shows $B_{32} \rightarrow B_{31} \rightarrow B_{19} \rightarrow B_{20}$ as an example.)

$$
\text { Claim - If } a_{n}>M \text { then } a_{n+1} \leq M
$$

Proof. Assume for contradiction there's a first moment where $a_{n}>M$ and $a_{n+1}>M$, meaning the block $B_{n}$ was added to an all-yellow tower past $M$ that has height exceeding $M$. (This is the X'ed out region in the figure above.) In $B_{n}$ 's tower, every (yellow) block (including $B_{n}$ ) was contributed by a block placed in different towers at height $a_{n}>M$. So before $B_{n}$, there were already $a_{n+1}>M$ towers of height more than $M$. This contradicts minimality of $n$.

It follows that the set of indices with $a_{n} \leq M$ has arithmetic density at least half, so certainly at least some of the numbers must occur infinitely often. Of the numbers in $\{1,2, \ldots, M\}$, define $L$ such that towers 1 through $L$ grow unbounded but towers $L+1$ through $M$ do not. Then we can pick a larger threshold $N^{\prime}>N$ such that

\begin{itemize}
  \item Towers 1 through $L$ have height greater than ( $M, N$ );
  \item Towers $L+1$ through $M$ will receive no further blocks;
  \item $a_{N^{\prime}} \leq L$.
\end{itemize}

After this threshold, the following statement is true:\\
Claim (Alternating small and big) - The terms $a_{N^{\prime}}, a_{N^{\prime}+2}, a_{N^{\prime}+4}, \ldots$ are all at most $L$ while the terms $a_{N^{\prime}+1}, a_{N^{\prime}+3}, a_{N^{\prime}+5}, \ldots$ are all greater than $M$.

IT Automaton for $n \equiv N^{\prime}(\bmod 2)$. From now on we always assume $n>N^{\prime}$. When $n \equiv N^{\prime}(\bmod 2)$, i.e., when $a_{n}$ is small, we define the state

$$
S(n)=\left(h_{1}, h_{2}, \ldots, h_{L} ; a_{n}\right) .
$$

For example, in the figure below, we illustrate how

$$
S(34)=\left(9,11 ; a_{34}=1\right) \longrightarrow S(36)=\left(9,12 ; a_{36}=2\right)
$$

\begin{center}
\fbox{\includegraphics[width=0.3\textwidth]{2025_08_08_a37278bc1cde189c383ag-08.jpg}}
\end{center}



The final element $a_{n}$ simply reminds us which tower was most recently incremented. At this point we can give a complete description of how to move from $S(n)$ to $S(n+2)$ :

\begin{itemize}
  \item The intermediate block $B_{n+1}$ is placed in the tower corresponding to the height $a_{n+1}$ of $B_{n}$;
  \item That tower will have height $a_{n+2}$ equal to the number of towers with height at least $a_{n+1}$; that is, it equals the cardinality of the set
\end{itemize}

$$
\left\{i: h_{i} \geq h_{a_{n}}\right\}
$$

\begin{itemize}
  \item We increment $h_{a_{n+2}}$ by 1 and update $a_{n}$.
\end{itemize}

For example, the illustrated $S(34) \rightarrow S(36)$ corresponds to the block $B_{34}$ at height $h_{1}$ in tower 1 giving the block $B_{35}$ at height 2 in tower $h_{1}$, then block $B_{36}$ at height $h_{2}+1$ being placed in tower 2.

Pigeonhole periodicity argument. Because only the relative heights matter in the automata above, if we instead define

$$
T(n)=\left(h_{1}-h_{2}, h_{2}-h_{3}, \ldots, h_{L-1}-h_{L} ; a_{n}\right) .
$$

then $T(n+2)$ can be determined from just $T(n)$.\\
So it would be sufficient to show $T(n)$ only takes on finitely many values to show that $T(n)$ (and hence $a_{n}$ ) is eventually periodic.

Since we have the bound $h_{k+1} \leq h_{k}+C$, we are done upon proving the following lower bound:

Claim - For every $1 \leq \ell<L$ and $n>N^{\prime}$, we have $h_{\ell} \leq h_{\ell+1}+C \cdot(L-1)$.

Proof. Assume for contradiction that there is some moment $n>N^{\prime}$ such that

$$
h_{\ell}>h_{\ell+1}+C \cdot(L-1)
$$

and WLOG assume that $h_{\ell}$ was just updated at the moment $n$. Together with $h_{k+1} \leq$ $h_{k}+C$ for all $k$ and triangle inequality, we conclude

$$
\min \left(h_{1}, \ldots, h_{\ell}\right)>q:=\max \left(h_{\ell+1}, \ldots, h_{L}\right) .
$$

We find that the blocks now in fact alternate between being placed among the first $\ell$ towers and in towers with indices greater than $q$ thereafter. Hence the heights $h_{\ell+1}, \ldots$, $h_{L}$ never grow after this moment. This contradicts the definition of $L$.

Remark. In fact, it can be shown that the period is actually exactly $L$, meaning the periodic part will be exactly a permutation of $(1,2, \ldots, L)$. For any $L$, it turns out there is indeed a permutation achieving that periodic part.
