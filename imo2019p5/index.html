<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMO 2019 P5 Simulation</title>
    <link rel="stylesheet" href="../tokens.css">
    <link rel="stylesheet" href="../base.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
    color-scheme: light dark;
            /* Light theme colors */
            --bg-primary: #F8FAFC;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F1F5F9;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            --border-primary: #E2E8F0;
            --border-secondary: #F1F5F9;
            --accent-primary: #7A9D8F;
            --accent-secondary: #9BB8AC;
            --accent-hover: #5A8070;
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;
            --border-primary: #334155;
            --border-secondary: #475569;
            --accent-primary: #7A9D8F;
            --accent-secondary: #9BB8AC;
            --accent-hover: #5A8070;
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.3);
        }
        body {
            font-family: var(--font-family);
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-secondary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            padding: 40px;
        }
        h1 {
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .problem-statement {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            border-left: 5px solid #7A9D8F;
        }
        .problem-statement h3 {
            color: #7A9D8F;
            margin-bottom: 10px;
        }
        .problem-statement p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: bold;
            color: #555;
        }
        input[type="number"] {
            padding: 10px;
            border: 2px solid var(--border-primary);
            border-radius: 5px;
            font-size: 16px;
            width: 100px;
        }
        input[type="text"] {
            padding: 10px;
            border: 2px solid var(--border-primary);
            border-radius: 5px;
            font-size: 16px;
            min-width: 200px;
        }
        button {
            padding: 12px 24px;
            background: #7A9D8F;
            color: white;
            border: none;
            border-radius:  8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover {
            background: #5A8070;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .coins-display {
            margin: 30px 0;
        }
        .coin-row {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            align-items: center;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }
        .coin {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative;
        }
        .coin.A {
            background: #F8FAFC;
            color: var(--text-primary);
        }
        .coin.B {
            background: #F8FAFC;
            color: var(--text-primary);
        }
        .coin:hover {
            transform: scale(1.1) rotate(10deg);
        }
        .coin.flipped {
            animation: flip 0.6s ease-in-out;
        }
        @keyframes flip {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }
        .step-label {
            font-weight: bold;
            color: #7A9D8F;
            min-width: 80px;
        }
        .trajectory {
            margin-top: 30px;
        }
        .trajectory h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: var(--bg-secondary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .analysis {
            margin-top: 30px;
        }
        .analysis h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .analysis-table th,
        .analysis-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-primary);
        }
        .analysis-table th {
            background: #7A9D8F;
            color: white;
        }
        .analysis-table tr:hover {
            background: var(--bg-tertiary);
        }
        .play-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .arrow {
            font-size: 2em;
            color: #7A9D8F;
            margin: 0 10px;
        }
        .highlighted {
            border: 3px solid #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
        }
        .answer-box {
            background: linear-gradient(135deg, #7A9D8F 0%, #9BB8AC 100%);
            box-shadow: 0 4px 12px rgba(122, 157, 143, 0.15);
            color: white;
            padding: 25px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .answer-box h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        .answer-box p {
            font-size: 1.2em;
            line-height: 1.6;
            margin: 10px 0;
        }
        .answer-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .theme-icon {
            display: none;
        }
                /* Motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
    <main id="main">
  <div class="container">
        <h1>IMO 2019 Problem 5</h1>
        <p>Bank of Bath Coin Process</p>
        <section aria-labelledby="problem-title">
  <div class="problem-statement">
            <h3>Problem Statement</h3>
            <p>The Bank of Bath issues coins with an <strong>A</strong> on one side and a <strong>B</strong> on the other.
               Harry has <em>n</em> of these coins arranged in a line from left to right.</p>
            <p><strong>Operation:</strong> If there are exactly <em>k</em> coins showing A, then Harry turns over the <em>k</em>-th coin from the left;
               otherwise, all coins show B and he stops.</p>
            <p><strong>Example:</strong> If n = 3, starting with AAB → ABB → BBB (3 operations)</p>
        </div>
        <div class="answer-box">
            <h2>Answer</h2>
            <p><strong>(a)<strong> The process <strong>always terminates<strong> in a finite number of steps for any initial configuration.</p>
            <p><strong>(b)<strong> The average value of f(C) over all 2^n possible initial configurations is:</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Number of Coins (n):</label>
                <input type="number" id="numCoins" value="3" min="1" max="10">
            </div>
            <div class="control-group">
                <label>Initial Configuration:</label>
                <input type="text" id="configInput" placeholder="e.g., AAB or 110">
            </div>
            <button onclick="randomConfig()">Random Config</button>
            <button onclick="runSimulation()">Run Simulation</button>
            <button onclick="analyzeAll()">Analyze All Configs</button>
        </div>
        <div class="stats" id="stats"></div>
        <div class="trajectory" id="trajectory"></div>
        <div class="analysis" id="analysis"></div>
    </div>
    </main>
  <script>
        let currentTrajectory = [];
        let currentStep = 0;
        function configToArray(str) {
            str = str.toUpperCase().replace(/\s/g, '');
            return str.split('').map(c => c === 'A' || c === '1' ? 1 : 0);
        }
        function configToString(arr) {
            return arr.map(c => c ? 'A' : 'B').join('');
        }
        function countA(config) {
            return config.reduce((sum, c) => sum + c, 0);
        }
        function step(config) {
            const k = countA(config);
            if (k === 0) return { newConfig: config, continues: false, flippedIndex: -1 };
            const newConfig = [...config];
            if (k <= config.length) {
                newConfig[k - 1] = 1 - newConfig[k - 1];
            }
            return { newConfig, continues: true, flippedIndex: k - 1 };
        }
        function simulate(initialConfig) {
            let config = [...initialConfig];
            const trajectory = [{ config: [...config], flippedIndex: -1 }];
            let steps = 0;
            const maxSteps = 10000;
            while (steps < maxSteps) {
                const result = step(config);
                config = result.newConfig;
                trajectory.push({ config: [...config], flippedIndex: result.flippedIndex });
                steps++;
                if (!result.continues) break;
            }
            return { steps, trajectory };
        }
        function renderCoins(config, flippedIndex = -1, label = '') {
            const row = document.createElement('div');
            row.className = 'coin-row';
            if (label) {
                const stepLabel = document.createElement('div');
                stepLabel.className = 'step-label';
                stepLabel.textContent = label;
                row.appendChild(stepLabel);
            }
            config.forEach((c, i) => {
                const coin = document.createElement('div');
                coin.className = `coin ${c ? 'A' : 'B'}`;
                if (i === flippedIndex) {
                    coin.classList.add('highlighted');
                }
                coin.textContent = c ? 'A' : 'B';
                coin.onclick = () => toggleCoin(i);
                row.appendChild(coin);
            });
            return row;
        }
        function toggleCoin(index) {
            const configInput = document.getElementById('configInput');
            let config = configToArray(configInput.value || 'B'.repeat(parseInt(document.getElementById('numCoins').value)));
            config[index] = 1 - config[index];
            configInput.value = configToString(config);
            runSimulation();
        }
        function randomConfig() {
            const n = parseInt(document.getElementById('numCoins').value);
            const config = Array.from({ length: n }, () => Math.random() < 0.5 ? 0 : 1);
            document.getElementById('configInput').value = configToString(config);
            runSimulation();
        }
        function runSimulation() {
            const n = parseInt(document.getElementById('numCoins').value);
            let configStr = document.getElementById('configInput').value;
            if (!configStr) {
                configStr = 'A'.repeat(n);
                document.getElementById('configInput').value = configStr;
            }
            const config = configToArray(configStr);
            const { steps, trajectory } = simulate(config);
            currentTrajectory = trajectory;
            // Update stats
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${steps}</div>
                    <div class="stat-label">Total Steps f(C)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${trajectory.length - 1}</div>
                    <div class="stat-label">Configurations Visited</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${configToString(config)}</div>
                    <div class="stat-label">Initial Config</div>
                </div>
            `;
            // Display trajectory
            const trajectoryDiv = document.getElementById('trajectory');
            trajectoryDiv.innerHTML = '<h3>Simulation Trajectory</h3>';
            trajectory.forEach((item, idx) => {
                const label = idx === 0 ? 'Initial:' :
                             idx === trajectory.length - 1 ? 'Final:' :
                             `Step ${idx}:`;
                const prevFlipped = idx > 0 ? trajectory[idx - 1].flippedIndex : -1;
                trajectoryDiv.appendChild(renderCoins(item.config, prevFlipped, label));
            });
        }
        function generateAllConfigs(n) {
            const configs = [];
            const total = Math.pow(2, n);
            for (let i = 0; i < total; i++) {
                const config = [];
                for (let j = 0; j < n; j++) {
                    config.push((i >> j) & 1);
                }
                configs.push(config);
            }
            return configs;
        }
        function analyzeAll() {
            const n = parseInt(document.getElementById('numCoins').value);
            if (n > 8) {
                alert('Please use n ≤ 8 for full analysis (2^n configurations)');
                return;
            }
            const configs = generateAllConfigs(n);
            const results = configs.map(config => {
                const { steps, trajectory } = simulate(config);
                return {
                    config: configToString(config),
                    steps,
                    trajectory
                };
            });
            // Calculate statistics
            const totalSteps = results.reduce((sum, r) => sum + r.steps, 0);
            const average = totalSteps / results.length;
            const distribution = {};
            results.forEach(r => {
                distribution[r.steps] = (distribution[r.steps] || 0) + 1;
            });
            const maxSteps = Math.max(...results.map(r => r.steps));
            const maxConfigs = results.filter(r => r.steps === maxSteps);
            // Display analysis
            const analysisDiv = document.getElementById('analysis');
            analysisDiv.innerHTML = `
                <h3>Analysis for n = ${n}</h3>
                <div class="stats" role="status" aria-live="polite">
                    <div class="stat-card">
                        <div class="stat-value">${results.length}</div>
                        <div class="stat-label">Total Configurations (2^${n})</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${average.toFixed(4)}</div>
                        <div class="stat-label">Average f(C)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${maxSteps}</div>
                        <div class="stat-label">Maximum Steps</div>
                    </div>
                </div>
                <h3>Step Distribution</h3>
                <table class="analysis-table">
                    <tr>
                        <th>Steps</th>
                        <th>Count</th>
                        <th>Percentage</th>
                    </tr>
                    ${Object.keys(distribution).sort((a, b) => a - b).map(steps => `
                        <tr>
                            <td>${steps}</td>
                            <td>${distribution[steps]}</td>
                            <td>${(100 * distribution[steps] / results.length).toFixed(2)}%</td>
                        </tr>
                    `).join('')}
                </table>
                <h3>Configurations with Maximum Steps (${maxSteps})</h3>
                <table class="analysis-table">
                    <tr>
                        <th>Configuration</th>
                        <th>Steps</th>
                        <th>Action</th>
                    </tr>
                    ${maxConfigs.map(r => `
                        <tr>
                            <td>${r.config}</td>
                            <td>${r.steps}</td>
                            <td><button onclick="showConfig('${r.config}')">View</button></td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }
        function showConfig(configStr) {
            document.getElementById('configInput').value = configStr;
            runSimulation();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        // Initialize with example
        window.onload = () => {
            document.getElementById('configInput').value = 'AAB';
            runSimulation();
        };
        </script>
</body>
</html>
